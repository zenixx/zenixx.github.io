<!DOCTYPE html>

<html>
	<head>
		<title>S0601: Кула от кубчета</title>
		<meta charset="utf-8">
		
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
		<script src="three.min.js"></script>
		<script src="stats.min.js"></script>
		<script src="physi.js"></script>
		<script src="WebGL.js"></script>
		<script src="OrbitControls.js"></script>
		<script src="vax.js"></script>
	</head>
	
	<body>
		<script>
			vaxInit();
			
			var control = new THREE.OrbitControls( camera, renderer.domElement );
			control.minDistance = 50;
			control.maxDistance = 300;
			control.minPolarAngle = 0.1;
			control.maxPolarAngle = 3.0; 
			control.rotateSpeed = 0.3;
			control.enableDamping = true;
			control.dampingFactor = 0.1;
			control.enablePan = false;

			// светлина и сенки
			renderer.shadowMap.enabled = true;
			light.shadow.mapSize = new THREE.Vector2( 1024*2, 1024*2 );
			light.position.set(-150,300,-50);
			light.intensity = 0.8;
			
			light = light.clone();
			light.intensity = 0.4;
			light.castShadow = true;
			scene.add( light );

			scene.add( new THREE.AmbientLight( 'yellow', 0.2 ) );
			
			camera.position.set(0,50,240);
			camera.lookAt(new THREE.Vector3(0,80,0));
			
				
			// земя
			var geometry = new THREE.BoxBufferGeometry( 100, 4, 100 ),
				material = Physijs.createMaterial( new THREE.MeshPhongMaterial({color:'lightgreen'}), 1, 0 );
			var ground = new Physijs.BoxMesh( geometry, material, 0 );
				ground.position.set( 0, -10, 0 );
				ground.receiveShadow = true;
			scene.add( ground );
			var ground1 = new Physijs.BoxMesh( geometry, material, 0 );
				ground1.position.set( 110, 0, 0 );
				ground1.receiveShadow = true;
				ground1.rotation.set.z = 90;
			scene.add(ground1);
			// кубчета
			var geometry = new THREE.BoxBufferGeometry( 20, 20, 20 ),
				material = Physijs.createMaterial( new THREE.MeshPhongMaterial({color:'hotpink'}), 1, 0 );
				
			var cubes = 1;
			var cube = undefined;
			
			// пускане на ново кубче
			function newCube( )
			{
				if( cubes>10 ) return;
				
				cubes++;

				var height = 100;
				
				if( cube )
				{
					height = cube.position.y + 50;
					cube.removeEventListener( 'collision', newCube );
				}
				
				cube = new Physijs.BoxMesh( geometry, material );
					cube.position.set( THREE.Math.randFloat(-5,5), height, THREE.Math.randFloat(-5,5) );
					cube.receiveShadow = true;
					cube.castShadow = true;
				scene.add( cube );
				
				cube.addEventListener( 'collision', newCube );
			}
						
			newCube();
			
			function animate()
			{
				scene.simulate( 1/10 );
				
			}
		</script>
	</body>
</html>


